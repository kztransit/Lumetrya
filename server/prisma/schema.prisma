
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

model SystemConfig {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  initials  String?
  createdAt DateTime @default(now())
  
  // Relations
  companyProfile CompanyProfile?
  reports        Report[]
  proposals      CommercialProposal[]
  campaigns      AdCampaign[]
  links          Link[]
  files          StoredFile[]
  payments       Payment[]
  otherReports   OtherReport[]
  brandAnalyses  BrandAnalysis[]
  adAudits       AdAuditResult[]
}

model CompanyProfile {
  id                   String   @id @default(uuid())
  userId               String   @unique
  user                 User     @relation(fields: [userId], references: [id])
  companyName          String
  legalName            String?
  tin                  String?
  kpp                  String?
  ogrn                 String?
  legalAddress         String?
  bankName             String?
  bic                  String?
  correspondentAccount String?
  checkingAccount      String?
  phones               String[] 
  email                String?
  address              String?
  about                String?
  aiSystemInstruction  String?
  darkModeEnabled      Boolean  @default(false)
  language             String   @default("ru")
  socialMedia          String[]
  websites             String[]
  
  employees            Employee[]
}

model Employee {
  id               String         @id @default(uuid())
  companyProfileId String
  companyProfile   CompanyProfile @relation(fields: [companyProfileId], references: [id])
  name             String
  position         String
}

model Report {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  name           String
  creationDate   DateTime @default(now())
  metrics        Json
  directions     Json
  netMetrics     Json?
}

model CommercialProposal {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  date           DateTime
  direction      String
  proposalNumber String
  invoiceNumber  String?
  company        String?
  item           String
  amount         Float
  invoiceDate    DateTime?
  paymentDate    DateTime?
  paymentType    String?
  status         String
}

model AdCampaign {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  name           String
  status         String
  type           String
  budgetType     String
  budget         Float
  impressions    Int
  clicks         Int
  ctr            Float
  spend          Float
  conversions    Float
  cpc            Float
  conversionRate Float
  cpa            Float
  strategy       String
  period         String
}

model Payment {
  id               String   @id @default(uuid())
  userId           String
  user             User     @relation(fields: [userId], references: [id])
  serviceName      String
  lastPaymentDate  DateTime
  nextPaymentDate  DateTime
  paymentPeriod    String
  amount           Float
  currency         String
  comment          String?
  paymentMethod    String
  paymentDetails   String?
  invoiceId        String?
  recipientName    String?
  recipientBin     String?
  recipientBank    String?
  recipientIic     String?
}

model StoredFile {
  id      String   @id @default(uuid())
  userId  String
  user    User     @relation(fields: [userId], references: [id])
  name    String
  type    String
  size    Int
  content String   
  date    DateTime @default(now())
}

model Link {
  id      String   @id @default(uuid())
  userId  String
  user    User     @relation(fields: [userId], references: [id])
  url     String
  comment String?
  date    DateTime @default(now())
}

model BrandAnalysis {
  id               String   @id @default(uuid())
  userId           String
  user             User     @relation(fields: [userId], references: [id])
  lastUpdate       DateTime @default(now())
  sentimentScore   Float
  mentionsCount    Int
  trustIndex       Float
  detailedFeedback Json
  reviews          Json
  mentions         Json
  swot             Json
  competitors      Json
  sources          Json
  recommendations  String[]
}

model OtherReport {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  name        String
  date        DateTime @default(now())
  category    String
  description String?
  kpis        Json
}

model AdAuditResult {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  keyword     String
  location    String
  timestamp   DateTime @default(now())
  advertisers Json
  organicTop  Json
  marketAnalysis String
}

model AdCampaignAuditReport {
  id            String   @id @default(uuid())
  timestamp     DateTime @default(now())
  globalScore   Float
  globalVerdict String
  campaigns     Json
}
